# ðŸŽ¯ Recurring Task System - Complete Implementation

## âœ¨ Overview

A comprehensive recurring task scheduler for the Task Manager application, supporting:
- **Daily** recurrence (every N days or minutes/hours)
- **Weekly** recurrence (any combination of days)
- **Monthly** recurrence (by date or ordinal days)

Built with `node-schedule` for precise, reliable scheduling.

---

## ðŸ“‹ Quick Navigation

| Document | Purpose |
|----------|---------|
| **QUICK_START.md** | Get started in 3 steps |
| **API_QUICK_REFERENCE.md** | Copy-paste API examples |
| **RECURRING_TASKS_GUIDE.md** | Complete guide with detailed examples |
| **INSTALLATION.md** | Installation & troubleshooting |
| **IMPLEMENTATION_SUMMARY.md** | Technical implementation details |

---

## ðŸš€ Get Started Now

### 1. Run Database Schema
```bash
mysql -u root -p task_manager < init-data.sql
```

### 2. Start Backend
```bash
cd backend
pnpm run dev
```

### 3. Create a Test Task
```bash
curl -X POST http://localhost:3000/api/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Test Task - Every 5 Minutes",
    "isRecurring": true,
    "recurrence": {
      "recurrenceType": "DAILY",
      "dailyRule": {
        "recurEveryXDays": 1,
        "intraDayFrequencyType": "MINUTES",
        "intraDayInterval": 5
      }
    }
  }'
```

Watch the console - new tasks will be created every 5 minutes!

---

## ðŸŽ¯ What's Supported

### 1. Daily Recurrence âœ…
- Every N days (1, 2, 3...)
- Every N minutes (monitoring)
- Every N hours (maintenance)

**Example**: Backup every night at 2 AM
```json
{
  "recurrenceType": "DAILY",
  "dailyRule": { "recurEveryXDays": 1 },
  "startTime": "02:00:00"
}
```

### 2. Weekly Recurrence âœ…
- Any combination of weekdays
- Every N weeks

**Example**: Team meeting every Monday and Friday
```json
{
  "recurrenceType": "WEEKLY",
  "weeklyRule": {
    "recurEveryNWeeks": 1,
    "daysOfWeek": {
      "monday": true,
      "friday": true
    }
  }
}
```

### 3. Monthly Recurrence âœ…

#### By Day of Month
- Specific dates (1-31)
- Last day of month ("L")

**Example**: Payroll on 1st and 15th
```json
{
  "recurrenceType": "MONTHLY",
  "monthlyRule": {
    "ruleType": "BY_DAY_OF_MONTH",
    "months": [1,2,3,4,5,6,7,8,9,10,11,12],
    "dayNumbers": ["1", "15"]
  }
}
```

#### By Ordinal Day
- First, Second, Third, Fourth, Last
- Any day of the week

**Example**: Board meeting on Last Friday of quarter
```json
{
  "recurrenceType": "MONTHLY",
  "monthlyRule": {
    "ruleType": "BY_ORDINAL_DAY_OF_WEEK",
    "months": [3, 6, 9, 12],
    "ordinals": [{
      "ordinal": "LAST",
      "dayOfWeek": "FRIDAY"
    }]
  }
}
```

---

## ðŸ”§ Key Features

### âœ… Automatic Task Recreation
- Creates new instances at scheduled times
- Copies all subtasks
- Preserves assignments (users & groups)
- Resets status to "To Do"

Note: Instances generated by the scheduler are not themselves recurring tasks. The scheduler creates new task instances with IsRecurring = FALSE and RecurrenceId = NULL so that those created instances are not scheduled again (avoids exponential creation).

### âœ… Smart Date Handling
- Stores times in UTC
- Auto-converts from IST
- Preserves task duration
- Recalculates next occurrence

### âœ… Flexible Scheduling
- Uses industry-standard `node-schedule`
- Supports cron expressions
- Custom date functions for complex patterns
- End date support

### âœ… Real-time Updates
- Tasks scheduled on creation
- Auto-reschedule on update
- Cancel on deletion
- Standalone or integrated operation

---

## ðŸ“Š Architecture

```
Backend (Express API)
    â†“
Task Service
    â†“
Rescheduler Library (node-schedule)
    â†“
MySQL Database
    â”œâ”€â”€ RecurrenceRules
    â”œâ”€â”€ Repeat_DailyRules
    â”œâ”€â”€ Repeat_WeeklyRules
    â””â”€â”€ Repeat_MonthlyRules
```

### Files Structure
```
task-manager/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ src/modules/task/
â”‚       â”œâ”€â”€ task.service.ts (Updated)
â”‚       â”œâ”€â”€ task.controller.ts
â”‚       â”œâ”€â”€ task.types.ts (Updated)
â”‚       â””â”€â”€ recurrence.service.ts
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ rescheduler-lib/
â”‚       â”œâ”€â”€ src/index.ts (NEW)
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â””â”€â”€ README.md
â””â”€â”€ Documentation/
    â”œâ”€â”€ QUICK_START.md
    â”œâ”€â”€ API_QUICK_REFERENCE.md
    â”œâ”€â”€ RECURRING_TASKS_GUIDE.md
    â”œâ”€â”€ INSTALLATION.md
    â””â”€â”€ IMPLEMENTATION_SUMMARY.md
```

---

## ðŸ’¼ Real-World Examples

### System Maintenance
```json
// Database backup every night at 2 AM
{ "recurrenceType": "DAILY", "dailyRule": { "recurEveryXDays": 1 }, "startTime": "02:00:00" }

// Health check every 15 minutes
{ "recurrenceType": "DAILY", "dailyRule": { "recurEveryXDays": 1, "intraDayFrequencyType": "MINUTES", "intraDayInterval": 15 } }
```

### Business Processes
```json
// Payroll on 1st and 15th
{ "recurrenceType": "MONTHLY", "monthlyRule": { "ruleType": "BY_DAY_OF_MONTH", "dayNumbers": ["1", "15"] } }

// Quarterly reports (last Friday)
{ "recurrenceType": "MONTHLY", "monthlyRule": { "ruleType": "BY_ORDINAL_DAY_OF_WEEK", "months": [3, 6, 9, 12], "ordinals": [{ "ordinal": "LAST", "dayOfWeek": "FRIDAY" }] } }
```

### Team Collaboration
```json
// Daily standup (Mon-Fri at 9 AM)
{ "recurrenceType": "WEEKLY", "weeklyRule": { "recurEveryNWeeks": 1, "daysOfWeek": { "monday": true, "tuesday": true, "wednesday": true, "thursday": true, "friday": true } } }

// Sprint planning (every 2 weeks on Monday)
{ "recurrenceType": "WEEKLY", "weeklyRule": { "recurEveryNWeeks": 2, "daysOfWeek": { "monday": true } } }
```

---

## ðŸ“– API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/tasks` | POST | Create recurring task |
| `/api/tasks/:id` | PUT | Update recurrence pattern |
| `/api/tasks/:id` | GET | Get task with recurrence details |
| `/api/tasks/:id` | DELETE | Delete and cancel schedule |

See **API_QUICK_REFERENCE.md** for detailed examples.

---

## ðŸ› ï¸ Technical Stack

- **node-schedule** ^2.1.1 - Core scheduling engine
- **mysql2** ^3.15.2 - Database
- **TypeScript** - Full type safety
- **Express** - REST API
- **Monorepo** - Workspace architecture

---

## ðŸ“ Database Schema

```sql
-- Main recurrence configuration
RecurrenceRules (Id, RecurrenceType, EndDate, DailyRuleId, WeeklyRuleId, MonthlyRuleId)

-- Specific recurrence rules
Repeat_DailyRules (Id, RecurEveryXDays, IntraDayFrequencyType, IntraDayInterval)
Repeat_WeeklyRules (Id, RecurEveryNWeeks, OnSunday...OnSaturday)
Repeat_MonthlyRules (Id, RuleType)
    â”œâ”€â”€ Repeat_MonthlyRule_Months (MonthlyRuleId, MonthNumber)
    â”œâ”€â”€ Repeat_MonthlyRule_Days (MonthlyRuleId, DayNumber)
    â””â”€â”€ Repeat_MonthlyRule_Ordinals (MonthlyRuleId, Ordinal, DayOfWeek)

-- Updated Tasks table
Tasks (Id, Title, StartDate, StartTime, DueDate, DueTime, IsRecurring, RecurrenceId, ...)
```

---

## âš™ï¸ Configuration

### Required
```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=task_manager
```

### Optional (defaults shown)
All configuration has sensible defaults and is optional.

---

## ðŸ” Monitoring

The scheduler logs all operations:
```
ðŸš€ Initializing Recurring Task Scheduler...
ðŸ“‹ Found 3 recurring task(s) to schedule
âœ… Scheduled task 123 (Daily Backup) - Type: DAILY
   Next execution: 2025-10-30T02:00:00.000Z
â° Executing recurring task: 123 - Daily Backup
âœ… Created new task instance: 456 for recurring task 123
```

---

## ðŸ†˜ Support

### Quick Fixes
1. **Build errors**: `cd packages/rescheduler-lib && pnpm run build`
2. **Not executing**: Check `IsRecurring = TRUE` and `RecurrenceId IS NOT NULL`
3. **Connection errors**: Verify MySQL is running and credentials are correct

### Documentation
- **INSTALLATION.md** - Detailed troubleshooting
- **RECURRING_TASKS_GUIDE.md** - Complete reference

---

## âœ… Checklist

Before using the system:
- [ ] Database schema created (`init-data.sql`)
- [ ] Dependencies installed (`pnpm install`)
- [ ] Rescheduler built (`pnpm run build`)
- [ ] `.env` configured with database credentials
- [ ] Backend started (`pnpm run dev`)

---

## ðŸŽŠ You're Ready!

The system is **production-ready** and fully tested. Start creating recurring tasks and watch them automatically manage themselves!

### Next Steps:
1. âœ… Read **QUICK_START.md** (3 steps to first task)
2. âœ… Try examples from **API_QUICK_REFERENCE.md**
3. âœ… Explore patterns in **RECURRING_TASKS_GUIDE.md**
4. âœ… Integrate with your frontend

---

## ðŸ“„ License

Part of the Task Manager application.

## ðŸ¤ Contributing

The code is heavily commented and documented. Feel free to extend and customize!

---

**Built with â¤ï¸ using node-schedule**

*For detailed implementation notes, see IMPLEMENTATION_SUMMARY.md*
